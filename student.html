<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc Sinh L√†m B√†i</title>
    <style>
        body { font-family: sans-serif; background: #e0f7fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        select { width: 100%; padding: 15px; font-size: 1.1em; margin-bottom: 20px; border: 2px solid #009688; border-radius: 5px; }
        
        .post { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; background: #fff; border-radius: 5px; }
        .english-content { white-space: pre-wrap; font-family: 'Courier New', monospace; background: #fafafa; padding: 10px; border: 1px dashed #aaa; margin: 10px 0; }
        
        input, textarea { width: 100%; margin-top: 5px; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; }
        button { background: #009688; color: white; border: none; padding: 10px 20px; cursor: pointer; margin-top: 10px; width: 100%; }
        h2 { color: #00796b; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h2>üë®‚Äçüéì KHU V·ª∞C H·ªåC SINH</h2>
    
    <label><b>Ch·ªçn l·ªõp c·ªßa em:</b></label>
    <select id="class-select" onchange="loadClassAssignments()">
        <option value="">-- Vui l√≤ng ch·ªçn l·ªõp --</option>
    </select>

    <div id="assignment-area">
        <p style="text-align:center; color: #666;">Ch·ªçn l·ªõp ·ªü tr√™n ƒë·ªÉ xem b√†i t·∫≠p nh√©!</p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // --- D√ÅN CONFIG GI·ªêNG H·ªÜT FILE GI√ÅO VI√äN ---
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "...",
        databaseURL: "...",
        projectId: "...",
        storageBucket: "...",
        messagingSenderId: "...",
        appId: "..."
    };
    // -------------------------------------------

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 1. Load danh s√°ch l·ªõp v√†o th·∫ª Select
    onValue(ref(db, 'classes'), (snap) => {
        const select = document.getElementById('class-select');
        const data = snap.val();
        // Gi·ªØ option ƒë·∫ßu ti√™n
        select.innerHTML = '<option value="">-- Vui l√≤ng ch·ªçn l·ªõp --</option>'; 
        
        if(data) {
            Object.keys(data).forEach(key => {
                select.innerHTML += `<option value="${key}">${data[key].name}</option>`;
            });
        }
    });

    // 2. H√†m load b√†i t·∫≠p khi ch·ªçn l·ªõp
    window.loadClassAssignments = function() {
        const classId = document.getElementById('class-select').value;
        const area = document.getElementById('assignment-area');
        
        if(!classId) {
            area.innerHTML = "<p style='text-align:center'>Ch·ªçn l·ªõp ·ªü tr√™n ƒë·ªÉ xem b√†i t·∫≠p nh√©!</p>";
            return;
        }

        area.innerHTML = "<i>ƒêang t·∫£i b√†i t·∫≠p...</i>";

        onValue(ref(db, `assignments/${classId}`), (snap) => {
            area.innerHTML = "";
            const data = snap.val();
            
            if(!data) {
                area.innerHTML = "<p>Th·∫ßy c√¥ ch∆∞a giao b√†i t·∫≠p n√†o cho l·ªõp n√†y.</p>";
                return;
            }

            Object.keys(data).reverse().forEach(key => {
                const q = data[key];
                area.innerHTML += `
                    <div class="post">
                        <h3>${q.title}</h3>
                        <div class="english-content">${q.content}</div>
                        <hr>
                        <b>N·ªôp b√†i l√†m:</b>
                        <input type="text" id="n-${key}" placeholder="T√™n c·ªßa em (VD: Nguy·ªÖn VƒÉn A)">
                        <textarea id="a-${key}" rows="3" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa em..."></textarea>
                        <button onclick="submitAnswer('${classId}', '${key}')">N·ªòP B√ÄI</button>
                    </div>
                `;
            });
        });
    }

    // 3. N·ªôp b√†i
    window.submitAnswer = function(classId, assignmentId) {
        const name = document.getElementById(`n-${assignmentId}`).value;
        const ans = document.getElementById(`a-${assignmentId}`).value;

        if(name && ans) {
            // L∆∞u b√†i l√†m v√†o: answers -> classId -> assignmentId -> danh s√°ch b√†i n·ªôp
            push(ref(db, `answers/${classId}/${assignmentId}`), {
                name: name,
                answer: ans,
                timestamp: Date.now()
            });
            alert("ƒê√£ n·ªôp b√†i th√†nh c√¥ng!");
            document.getElementById(`a-${assignmentId}`).value = ""; // X√≥a n·ªôi dung ƒë·ªÉ tr√°nh n·ªôp ƒë√∫p
        } else {
            alert("Em nh·ªõ ƒëi·ªÅn t√™n v√† c√¢u tr·∫£ l·ªùi nh√©!");
        }
    }
</script>
</body>
</html>