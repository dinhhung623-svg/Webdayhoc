<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω L·ªõp H·ªçc (Gi√°o Vi√™n)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; height: 100vh; margin: 0; background: #f0f2f5; }
        
        /* SIDEBAR */
        .sidebar { width: 280px; background: #2c3e50; color: white; display: flex; flex-direction: column; border-right: 1px solid #ddd; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #34495e; background: #1a252f; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 10px; }
        
        .class-item { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; margin-bottom: 5px; border-radius: 6px; 
            background: #34495e; cursor: pointer; transition: 0.2s;
        }
        .class-item:hover { background: #16a085; }
        .class-item.active { background: #1abc9c; border-left: 4px solid #fff; }
        .class-name { flex: 1; font-weight: 500; }
        .class-actions { display: none; gap: 8px; }
        .class-item:hover .class-actions { display: flex; } /* Ch·ªâ hi·ªán n√∫t khi di chu·ªôt v√†o */
        
        .btn-icon { background: none; border: none; color: #fff; cursor: pointer; font-size: 0.9em; padding: 2px; }
        .btn-icon:hover { color: #f1c40f; }
        .btn-icon.del:hover { color: #e74c3c; }

        .add-class-btn { width: 100%; padding: 15px; background: #e67e22; border: none; color: white; cursor: pointer; font-weight: bold; font-size: 1em; }
        .add-class-btn:hover { background: #d35400; }

        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }
        .hidden { display: none !important; }

        .editor-box { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; }
        
        /* Form inputs */
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; font-family: inherit; box-sizing: border-box; }
        textarea { resize: vertical; font-family: 'Courier New', monospace; line-height: 1.5; }
        
        .btn-primary { background: #2980b9; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-primary:hover { background: #2471a3; }

        /* Danh s√°ch b√†i t·∫≠p */
        .assignment-card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 5px solid #bdc3c7; position: relative; }
        .assignment-card.theory { border-left-color: #8e44ad; } /* M√†u t√≠m cho l√Ω thuy·∫øt */
        .assignment-card.exercise { border-left-color: #27ae60; } /* M√†u xanh cho b√†i t·∫≠p */
        
        .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; color: white; margin-bottom: 5px; }
        .bg-theory { background: #8e44ad; }
        .bg-exercise { background: #27ae60; }

        .card-actions { position: absolute; top: 15px; right: 15px; }
        .english-content { white-space: pre-wrap; background: #fafafa; padding: 15px; border: 1px dashed #ddd; margin-top: 10px; font-family: 'Consolas', monospace; }
        
        .loading { text-align: center; color: #7f8c8d; padding: 20px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h3 style="margin:0; color:#ecf0f1;"><i class="fas fa-chalkboard-teacher"></i> Gi√°o Vi√™n</h3>
    </div>
    <div class="sidebar-content" id="class-list">
        <div class="loading">ƒêang t·∫£i l·ªõp...</div>
    </div>
    <button class="add-class-btn" onclick="addClass()"><i class="fas fa-plus-circle"></i> T·∫°o L·ªõp M·ªõi</button>
</div>

<div class="main-content">
    
    <div id="welcome-screen" style="text-align: center; margin-top: 10vh; color: #7f8c8d;">
        <i class="fas fa-school" style="font-size: 5em; margin-bottom: 20px;"></i>
        <h2>Ch√†o m·ª´ng th·∫ßy/c√¥!</h2>
        <p>Ch·ªçn m·ªôt l·ªõp b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu so·∫°n gi√°o √°n.</p>
    </div>

    <div id="class-manager" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 id="current-class-name" style="color: #2c3e50; margin: 0;"></h2>
            <div style="color: #7f8c8d; font-size: 0.9em;">
                <i class="fas fa-info-circle"></i> ƒêang qu·∫£n l√Ω
            </div>
        </div>

        <div class="editor-box">
            <h3 style="margin-top:0; color: #2980b9;"><i class="fas fa-edit"></i> So·∫°n N·ªôi Dung</h3>
            
            <label><b>Ti√™u ƒë·ªÅ:</b></label>
            <input type="text" id="a-title" placeholder="VD: Unit 8 - Grammar: Although / However">
            
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label><b>Lo·∫°i b√†i:</b></label>
                    <select id="a-type">
                        <option value="theory">üìñ L√Ω thuy·∫øt (Grammar)</option>
                        <option value="exercise">üìù B√†i t·∫≠p (Practice)</option>
                    </select>
                </div>
            </div>

            <label><b>N·ªôi dung (Copy t·ª´ Word d√°n v√†o ƒë√¢y):</b></label>
            <textarea id="a-content" rows="8" placeholder="D√°n n·ªôi dung l√Ω thuy·∫øt ho·∫∑c c√¢u h·ªèi tr·∫Øc nghi·ªám v√†o ƒë√¢y..."></textarea>
            
            <button class="btn-primary" onclick="addAssignment()"><i class="fas fa-paper-plane"></i> ƒêƒÉng B√†i</button>
        </div>

        <h3 style="color: #34495e;">üìö Danh s√°ch b√†i h·ªçc c·ªßa l·ªõp n√†y</h3>
        <div id="assignment-list">
            </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // --- C·∫§U H√åNH FIREBASE ---
    const firebaseConfig = {
      apiKey: "AIzaSyDjSb3byp5-SMUdJU5XDnGXwKEUOLXI6JE",
      authDomain: "lophoconl.firebaseapp.com",
      databaseURL: "https://lophoconl-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "lophoconl",
      storageBucket: "lophoconl.firebasestorage.app",
      messagingSenderId: "1051247561864",
      appId: "1:1051247561864:web:43886eee9886cafd59a33d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let currentClassId = null;

    // --- 1. QU·∫¢N L√ù L·ªöP H·ªåC (CRUD) ---

    // Th√™m l·ªõp
    window.addClass = function() {
        const name = prompt("Nh·∫≠p t√™n l·ªõp m·ªõi (VD: L·ªõp 10A1):");
        if(name) {
            push(ref(db, 'classes'), { name: name });
        }
    }

    // S·ª≠a t√™n l·ªõp
    window.editClass = function(e, id, oldName) {
        e.stopPropagation(); // NgƒÉn vi·ªác click v√†o n√∫t s·ª≠a th√¨ b·ªã ch·ªçn l·ªõp
        const newName = prompt("ƒê·ªïi t√™n l·ªõp th√†nh:", oldName);
        if(newName && newName !== oldName) {
            update(ref(db, `classes/${id}`), { name: newName });
        }
    }

    // X√≥a l·ªõp (X√≥a s·∫°ch d·ªØ li·ªáu li√™n quan)
    window.deleteClass = function(e, id) {
        e.stopPropagation();
        if(confirm("C·∫¢NH B√ÅO NGUY HI·ªÇM!\n\nH√†nh ƒë·ªông n√†y s·∫Ω x√≥a vƒ©nh vi·ªÖn:\n- L·ªõp h·ªçc n√†y\n- T·∫•t c·∫£ b√†i t·∫≠p trong l·ªõp\n- T·∫•t c·∫£ b√†i l√†m c·ªßa h·ªçc sinh\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?")) {
            // Th·ª±c hi·ªán x√≥a chu·ªói 3 n∆°i
            remove(ref(db, `classes/${id}`));
            remove(ref(db, `assignments/${id}`));
            remove(ref(db, `answers/${id}`));
            
            // N·∫øu ƒëang ch·ªçn l·ªõp b·ªã x√≥a th√¨ reset giao di·ªán
            if(currentClassId === id) {
                currentClassId = null;
                document.getElementById('welcome-screen').classList.remove('hidden');
                document.getElementById('class-manager').classList.add('hidden');
            }
        }
    }

    // Hi·ªÉn th·ªã danh s√°ch l·ªõp (Realtime)
    onValue(ref(db, 'classes'), (snap) => {
        const list = document.getElementById('class-list');
        list.innerHTML = "";
        const data = snap.val();
        
        if(data) {
            Object.keys(data).forEach(key => {
                const cls = data[key];
                
                // T·∫°o item HTML
                const div = document.createElement('div');
                div.className = `class-item ${currentClassId === key ? 'active' : ''}`;
                div.onclick = () => selectClass(key, cls.name, div);
                
                div.innerHTML = `
                    <span class="class-name">${cls.name}</span>
                    <div class="class-actions">
                        <button class="btn-icon" onclick="editClass(event, '${key}', '${cls.name}')" title="ƒê·ªïi t√™n"><i class="fas fa-pen"></i></button>
                        <button class="btn-icon del" onclick="deleteClass(event, '${key}')" title="X√≥a l·ªõp"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                list.appendChild(div);
            });
        } else {
            list.innerHTML = "<div style='color:#bdc3c7; text-align:center; padding:10px;'>Ch∆∞a c√≥ l·ªõp n√†o</div>";
        }
    });

    // Ch·ªçn l·ªõp ƒë·ªÉ qu·∫£n l√Ω
    window.selectClass = function(key, name, element) {
        currentClassId = key;
        
        // C·∫≠p nh·∫≠t UI
        document.getElementById('welcome-screen').classList.add('hidden');
        document.getElementById('class-manager').classList.remove('hidden');
        document.getElementById('current-class-name').innerText = name;

        // Highlight active
        document.querySelectorAll('.class-item').forEach(el => el.classList.remove('active'));
        if(element) element.classList.add('active');

        // Load b√†i t·∫≠p
        loadAssignments(key);
    }

    // --- 2. QU·∫¢N L√ù B√ÄI T·∫¨P ---

    window.addAssignment = function() {
        if(!currentClassId) return alert("Vui l√≤ng ch·ªçn l·ªõp tr∆∞·ªõc!");
        
        const title = document.getElementById('a-title').value;
        const content = document.getElementById('a-content').value;
        const type = document.getElementById('a-type').value; // theory ho·∫∑c exercise

        if(title && content) {
            push(ref(db, `assignments/${currentClassId}`), {
                title: title,
                content: content,
                type: type,
                timestamp: Date.now()
            });
            alert("ƒê√£ ƒëƒÉng b√†i th√†nh c√¥ng!");
            // Reset form
            document.getElementById('a-title').value = "";
            document.getElementById('a-content').value = "";
        } else {
            alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");
        }
    }

    window.deleteAssignment = function(id) {
        if(confirm("X√≥a b√†i n√†y?")) {
            remove(ref(db, `assignments/${currentClassId}/${id}`));
        }
    }

    function loadAssignments(classId) {
        const listDiv = document.getElementById('assignment-list');
        listDiv.innerHTML = "<div class='loading'>ƒêang t·∫£i d·ªØ li·ªáu...</div>";
        
        onValue(ref(db, `assignments/${classId}`), (snap) => {
            listDiv.innerHTML = "";
            const data = snap.val();

            if(!data) {
                listDiv.innerHTML = "<p style='text-align:center; color:#999'>L·ªõp n√†y ch∆∞a c√≥ b√†i n√†o.</p>";
                return;
            }

            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                const typeClass = item.type === 'theory' ? 'theory' : 'exercise';
                const badgeClass = item.type === 'theory' ? 'bg-theory' : 'bg-exercise';
                const typeName = item.type === 'theory' ? 'L√Ω thuy·∫øt' : 'B√†i t·∫≠p';

                listDiv.innerHTML += `
                    <div class="assignment-card ${typeClass}">
                        <div class="card-actions">
                            <button onclick="deleteAssignment('${key}')" style="background:none; border:none; color:#c0392b; cursor:pointer;"><i class="fas fa-trash"></i> X√≥a</button>
                        </div>
                        <span class="badge ${badgeClass}">${typeName}</span>
                        <h3 style="margin: 5px 0;">${item.title}</h3>
                        <div class="english-content">${item.content}</div>
                    </div>
                `;
            });
        });
    }
</script>
</body>
</html>