<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω L·ªõp H·ªçc (Gi√°o Vi√™n)</title>
    <style>
        body { font-family: sans-serif; display: flex; height: 100vh; margin: 0; background: #f4f4f4; }
        
        /* Sidebar danh s√°ch l·ªõp */
        .sidebar { width: 250px; background: #2c3e50; color: white; padding: 20px; overflow-y: auto; }
        .sidebar h3 { border-bottom: 1px solid #444; padding-bottom: 10px; }
        .class-item { padding: 10px; cursor: pointer; border-radius: 5px; margin-bottom: 5px; background: #34495e; transition: 0.3s; }
        .class-item:hover, .class-item.active { background: #1abc9c; }
        .add-class-btn { width: 100%; padding: 10px; background: #e67e22; border: none; color: white; cursor: pointer; margin-top: 10px; }

        /* Khu v·ª±c n·ªôi dung ch√≠nh */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .hidden { display: none; }
        
        /* Form v√† Danh s√°ch b√†i t·∫≠p */
        .assignment-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; position: relative; }
        .btn-group { position: absolute; top: 15px; right: 15px; }
        .btn { padding: 5px 10px; border: none; cursor: pointer; color: white; border-radius: 3px; font-size: 0.8em; margin-left: 5px; }
        .btn-edit { background: #f39c12; }
        .btn-del { background: #c0392b; }
        .btn-add { background: #2980b9; padding: 10px 20px; font-size: 1em; width: 100%; margin-top: 10px;}

        input, textarea { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; border: 1px solid #ccc; }
        .english-content { white-space: pre-wrap; font-family: 'Courier New', monospace; background: #f9f9f9; padding: 10px; border: 1px dashed #ccc; }
    </style>
</head>
<body>

<div class="sidebar">
    <h3>üè´ Danh s√°ch l·ªõp</h3>
    <div id="class-list">
        </div>
    <button class="add-class-btn" onclick="addClass()">+ T·∫°o L·ªõp M·ªõi</button>
</div>

<div class="main-content">
    <div id="welcome-screen">
        <h2>üëã Ch√†o th·∫ßy/c√¥!</h2>
        <p>Vui l√≤ng ch·ªçn m·ªôt l·ªõp b√™n tay tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu so·∫°n b√†i.</p>
    </div>

    <div id="class-manager" class="hidden">
        <h2 id="current-class-name" style="color: #2c3e50;"></h2>
        <hr>
        
        <div style="background: #ecf0f1; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
            <h3>üìù So·∫°n B√†i T·∫≠p M·ªõi</h3>
            <input type="text" id="a-title" placeholder="Ti√™u ƒë·ªÅ (VD: Unit 1 - Present Simple)">
            <textarea id="a-content" rows="5" placeholder="N·ªôi dung b√†i t·∫≠p (ƒêi·ªÅn v√†o ch·ªó tr·ªëng, c√¢u h·ªèi tr·∫Øc nghi·ªám...)..."></textarea>
            <button class="btn btn-add" onclick="addAssignment()">ƒêƒÉng B√†i T·∫≠p</button>
        </div>

        <h3>Danh s√°ch b√†i t·∫≠p c·ªßa l·ªõp n√†y:</h3>
        <div id="assignment-list">ƒêang t·∫£i...</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // --- D√ÅN CONFIG C·ª¶A B·∫†N V√ÄO ƒê√ÇY ---
    const firebaseConfig = {
        apiKey: "AIzaSyDjSb3byp5-SMUdJU5XDnGXwKEUOLXI6JE",
        authDomain: "lophoconl.firebaseapp.com",
        databaseURL: "https://lophoconl-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "lophoconl",
        storageBucket: "lophoconl.firebasestorage.app",
        messagingSenderId: "1051247561864",
        appId: "1:1051247561864:web:43886eee9886cafd59a33d"
    };
    // ----------------------------------

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let currentClassId = null;

    // 1. QU·∫¢N L√ù L·ªöP H·ªåC (CLASSES)
    window.addClass = function() {
        const name = prompt("Nh·∫≠p t√™n l·ªõp m·ªõi (VD: L·ªõp 9A):");
        if(name) {
            push(ref(db, 'classes'), { name: name });
        }
    }

    // Hi·ªÉn th·ªã danh s√°ch l·ªõp b√™n Sidebar
    onValue(ref(db, 'classes'), (snap) => {
        const list = document.getElementById('class-list');
        list.innerHTML = "";
        const data = snap.val();
        
        if(data) {
            Object.keys(data).forEach(key => {
                const cls = data[key];
                const div = document.createElement('div');
                div.className = 'class-item';
                div.innerText = cls.name;
                div.onclick = () => selectClass(key, cls.name, div);
                list.appendChild(div);
            });
        }
    });

    // Khi gi√°o vi√™n ch·ªçn 1 l·ªõp
    window.selectClass = function(key, name, element) {
        currentClassId = key;
        document.getElementById('welcome-screen').classList.add('hidden');
        document.getElementById('class-manager').classList.remove('hidden');
        document.getElementById('current-class-name').innerText = "ƒêang qu·∫£n l√Ω: " + name;

        // Highlight l·ªõp ƒëang ch·ªçn
        document.querySelectorAll('.class-item').forEach(el => el.classList.remove('active'));
        element.classList.add('active');

        loadAssignments(key);
    }

    // 2. QU·∫¢N L√ù B√ÄI T·∫¨P (ASSIGNMENTS)
    
    // Th√™m b√†i
    window.addAssignment = function() {
        if(!currentClassId) return alert("Vui l√≤ng ch·ªçn l·ªõp tr∆∞·ªõc!");
        const title = document.getElementById('a-title').value;
        const content = document.getElementById('a-content').value;

        if(title && content) {
            push(ref(db, `assignments/${currentClassId}`), {
                title: title,
                content: content,
                timestamp: Date.now()
            });
            alert("ƒê√£ th√™m b√†i t·∫≠p!");
            document.getElementById('a-title').value = "";
            document.getElementById('a-content').value = "";
        } else {
            alert("Nh·∫≠p ƒë·ªß ti√™u ƒë·ªÅ v√† n·ªôi dung nh√©!");
        }
    }

    // X√≥a b√†i
    window.deleteAssignment = function(assignmentId) {
        if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i n√†y kh√¥ng?")) {
            remove(ref(db, `assignments/${currentClassId}/${assignmentId}`));
        }
    }

    // S·ª≠a b√†i (D√πng prompt cho ƒë∆°n gi·∫£n)
    window.editAssignment = function(assignmentId, oldTitle, oldContent) {
        // Trong th·ª±c t·∫ø n√™n d√πng Modal, ·ªü ƒë√¢y d√πng prompt ƒë·ªÉ code ng·∫Øn g·ªçn
        const newTitle = prompt("S·ª≠a ti√™u ƒë·ªÅ:", oldTitle);
        // Prompt kh√¥ng h·ªó tr·ª£ xu·ªëng d√≤ng t·ªët, nh∆∞ng t·∫°m th·ªùi d√πng ƒë·ªÉ demo
        const newContent = prompt("S·ª≠a n·ªôi dung (copy n·ªôi dung c≈© v√†o ƒë√¢y n·∫øu c·∫ßn):", oldContent); // L∆∞u √Ω: Prompt h∆°i b·∫•t ti·ªán cho text d√†i

        if(newTitle !== null && newContent !== null) {
             update(ref(db, `assignments/${currentClassId}/${assignmentId}`), {
                title: newTitle,
                content: newContent
            });
        }
    }

    // Load danh s√°ch b√†i t·∫≠p c·ªßa l·ªõp ƒëang ch·ªçn
    function loadAssignments(classId) {
        onValue(ref(db, `assignments/${classId}`), (snap) => {
            const listDiv = document.getElementById('assignment-list');
            listDiv.innerHTML = "";
            const data = snap.val();

            if(!data) {
                listDiv.innerHTML = "<p>L·ªõp n√†y ch∆∞a c√≥ b√†i t·∫≠p n√†o.</p>";
                return;
            }

            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                // X·ª≠ l√Ω n·ªôi dung ƒë·ªÉ truy·ªÅn v√†o h√†m s·ª≠a (tr√°nh l·ªói nh√°y ƒë∆°n/k√©p)
                const safeTitle = item.title.replace(/'/g, "\\'"); 
                const safeContent = item.content.replace(/'/g, "\\'").replace(/\n/g, "\\n");

                listDiv.innerHTML += `
                    <div class="assignment-card">
                        <div class="btn-group">
                            <button class="btn btn-edit" onclick="editAssignment('${key}', '${safeTitle}', '${safeContent}')">S·ª≠a</button>
                            <button class="btn btn-del" onclick="deleteAssignment('${key}')">X√≥a</button>
                        </div>
                        <h3>${item.title}</h3>
                        <div class="english-content">${item.content}</div>
                        <div style="margin-top:10px; border-top:1px dashed #eee; padding-top:5px; font-size:0.9em; color:blue;">
                            <a href="#" onclick="viewStudentAnswers('${key}')">Xem b√†i l√†m c·ªßa h·ªçc sinh (T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn...)</a>
                        </div>
                    </div>
                `;
            });
        });
    }
    
    window.viewStudentAnswers = function(id) {
        alert("Ch·ª©c nƒÉng xem b√†i l√†m chi ti·∫øt s·∫Ω t√≠ch h·ª£p ·ªü ph·∫ßn sau!");
    }
</script>
</body>
</html>